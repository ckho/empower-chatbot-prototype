{"version":3,"sources":["../src/app.js"],"names":["app","Koa","router","Router","messageClient","FacebookMessagingAPIClient","process","env","PAGE_ACCESS_TOKEN","profileClient","FacebookProfileAPIClient","get","ctx","next","console","log","ValidateWebhook","validateServer","post","req","res","incomingMessages","messageParser","parsePayload","body","messagingClient","markSeen","senderId","toggleTyping","result","sendTextMessage","e","use","routes","allowedMethods","listen"],"mappings":";;AAAA;;AACA;;;;AACA;;;;;;AAEA,IAAIA,MAAM,IAAIC,aAAJ,EAAV;AACA,IAAIC,SAAS,IAAIC,mBAAJ,EAAb;;AAEA,MAAMC,gBAAgB,IAAIC,6CAAJ,CAA+BC,QAAQC,GAAR,CAAYC,iBAA3C,CAAtB;;AAEA,MAAMC,gBAAgB,IAAIC,2CAAJ,CAA6BJ,QAAQC,GAAR,CAAYC,iBAAzC,CAAtB;;AAEA;;AAEAN,OAAOS,GAAP,CAAW,GAAX,EAAgB,CAACC,GAAD,EAAMC,IAAN,KAAe;AAC7B;AACD,CAFD;;AAIAC,QAAQC,GAAR,CAAYT,QAAQC,GAApB;;AAEAL,OAAOS,GAAP,CAAW,cAAX,EAA0BK,mCAAgBC,cAA1C;AACAf,OAAOgB,IAAP,CAAY,cAAZ,EAA4B,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAC9C,MAAI;AACF,UAAMC,mBAAmBC,cAAcC,YAAd,CAA2BJ,IAAIK,IAA/B,CAAzB;AACA,UAAMC,gBAAgBC,QAAhB,CAAyBC,QAAzB,CAAN;AACA,UAAMF,gBAAgBG,YAAhB,CAA6BD,QAA7B,EAAsC,IAAtC,CAAN;AACA;AACA,UAAME,SAAS,MAAMJ,gBAAgBK,eAAhB,CAAgCH,QAAhC,EAA0C,OAA1C,CAArB;AACAb,YAAQC,GAAR,CAAY,6BAAZ;AACD,GAPD,CAOE,OAAMgB,CAAN,EAAQ;AACRjB,YAAQC,GAAR,CAAYgB,CAAZ;AACD;AACD;AACAN,kBAAgBK,eAAhB,CAAgCH,QAAhC,EAA0C,OAA1C,EAAmDE,MAAD,IAAYf,QAAQC,GAAR,CAAY,6BAAZ,CAA9D;AACA;AACA;AACD,CAfD;;AAiBAf,IACGgC,GADH,CACO9B,OAAO+B,MAAP,EADP,EAEGD,GAFH,CAEO9B,OAAOgC,cAAP,EAFP;;AAIAlC,IAAImC,MAAJ,CAAW,IAAX","file":"app.js","sourcesContent":["import {FacebookMessagingAPIClient, FacebookProfileAPIClient, ValidateWebhook, FacebookMessageParser} from 'fb-messenger-bot-api';\nimport Koa from 'koa';\nimport Router from 'koa-router';\n\nlet app = new Koa();\nlet router = new Router();\n\nconst messageClient = new FacebookMessagingAPIClient(process.env.PAGE_ACCESS_TOKEN);\n\nconst profileClient = new FacebookProfileAPIClient(process.env.PAGE_ACCESS_TOKEN);\n\n// const result = await profileClient.setGreetingMessage('Hello World! Welcome to EMpower.');\n\nrouter.get('/', (ctx, next) => {\n  // ctx.router available\n});\n\nconsole.log(process.env);\n\nrouter.get('/api/webhook',ValidateWebhook.validateServer);\nrouter.post('/api/webhook', async (req, res) => {\n  try {\n    const incomingMessages = messageParser.parsePayload(req.body);  \n    await messagingClient.markSeen(senderId);\n    await messagingClient.toggleTyping(senderId,true);\n    //promise based reaction on message send confirmation\n    const result = await messagingClient.sendTextMessage(senderId, 'Hello');\n    console.log('Result sent with: ${result}');\n  } catch(e){\n    console.log(e)\n  };\n  //callback based reaction on message confirmation\n  messagingClient.sendTextMessage(senderId, 'Hello',(result) => console.log('Result sent with: ${result}'));\n  // //silent message sending\n  // messagingClient.sendTextMessage(senderId,'Hello');\n});\n\napp\n  .use(router.routes())\n  .use(router.allowedMethods());\n\napp.listen(3000);\n"]}